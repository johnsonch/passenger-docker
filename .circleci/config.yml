---
version: 2
jobs:
  deploy:
    machine: true
    steps:
      - checkout
      - run:
          name: Build and push docker image
          command: |
            echo $dockerhub | docker login -u $dockerhub_username --password-stdin
            cp Makefile CustomMakefile
            sed "s/phusion/johnsonch/g" CustomMakefile > Makefile
            make all
            make tag_latest
            make release


workflows:
  version: 2
  main:
    jobs:
      - deploy:
          filters:
            branches:
              only:
                - latest_rvm_support
